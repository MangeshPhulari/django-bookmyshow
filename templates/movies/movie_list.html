{% extends "users/basic.html" %}

{% block content %}
<style>
    /* Aspect ratio wrapper for movie images */
    .img-aspect-wrapper {
        position: relative;
        width: 100%;
        padding-bottom: 140%; /* Adjust this percentage for desired aspect ratio (e.g., 140% for tall posters) */
        overflow: hidden;
    }
    .img-aspect-wrapper img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover; /* Cover ensures the image fills the space */
    }
    /* Ensure filter labels are visible on small screens */
    .filter-form label { display: block; margin-bottom: 0.5rem; }
</style>

<div class="container py-5">
    <h1 class="text-center mb-4">Movies</h1>

    <div class="card card-body mb-5 shadow-sm filter-form">
        <form method="GET" action="{% url 'movie_list' %}">
            <div class="row g-3 align-items-end">
                <div class="col-12 mb-3">
                    <label for="searchInput" class="sr-only">Search</label> 
                    <input class="form-control form-control-lg" id="searchInput" name="search" placeholder="Search by Movie Title or Cast..." type="text" value="{{ search_query }}">
                </div>
                <div class="col-md-6 col-lg-5 mb-3 mb-md-0">
                    <label for="genre">Genre:</label>
                    <select name="genre" id="genre" class="form-control">
                        <option value="">All Genres</option>
                        {% for value, display in genres %}
                            <option value="{{ value }}" {% if value == selected_genre %}selected{% endif %}>{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6 col-lg-5 mb-3 mb-md-0">
                    <label for="language">Language:</label>
                    <select name="language" id="language" class="form-control">
                        <option value="">All Languages</option>
                        {% for value, display in languages %}
                            <option value="{{ value }}" {% if value == selected_language %}selected{% endif %}>{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-lg-2 col-md-12"> 
                    <button type="submit" class="btn btn-primary btn-block w-100">Search</button> 
                </div>
            </div>
        </form>
    </div>

    <div class="row" id="movieList">
        {% for movie in movies %}
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm">
                <a href="{% url 'movie_detail' movie.pk %}">
                    <div class="img-aspect-wrapper">
                         <img src="{{ movie.image.url }}" class="card-img-top" alt="{{ movie.name }}">
                    </div>
                </a>
                <div class="card-body d-flex flex-column"> 
                    <h5 class="card-title">{{ movie.name }}</h5>
                    <p class="card-text text-muted small">{{ movie.genre }} | {{ movie.language }}</p>
                    <p class="card-text small">
                        <i class="fas fa-star text-warning"></i> 
                    </p>
                    <a href="{% url 'movie_detail' movie.pk %}" class="btn btn-outline-primary btn-sm mt-auto"> 
                        View Details <i class="fas fa-chevron-right ml-1 small"></i> 
                    </a>
                </div>
                
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center">
            <p class="lead">No movies found. Try adjusting your search or filters.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}